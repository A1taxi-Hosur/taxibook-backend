{% extends "admin/base.html" %}

{% block title %}Live Map - TaxiBook Admin{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Live Driver Map</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="toggleFilters()">
                <i class="bi bi-funnel"></i> Filters
            </button>
            <button type="button" class="btn btn-sm btn-outline-info" onclick="toggleDriverList()">
                <i class="bi bi-list"></i> Driver List
            </button>
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-sm btn-success" id="autoRefreshBtn" onclick="toggleAutoRefresh()">
                <i class="bi bi-arrow-clockwise"></i> Auto Refresh: ON
            </button>
            <button type="button" class="btn btn-sm btn-primary" onclick="refreshDrivers()">
                <i class="bi bi-arrow-clockwise"></i> Refresh Now
            </button>
        </div>
    </div>
</div>

<!-- Filters Panel -->
<div class="card mb-3" id="filters-panel" style="display: none;">
    <div class="card-body">
        <div class="row">
            <div class="col-md-3">
                <label for="statusFilter" class="form-label">Status</label>
                <select class="form-select" id="statusFilter" onchange="applyFilters()">
                    <option value="">All Status</option>
                    <option value="online">Online</option>
                    <option value="busy">Busy</option>
                    <option value="offline">Offline</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="companyFilter" class="form-label">Company</label>
                <select class="form-select" id="companyFilter" onchange="applyFilters()">
                    <option value="">All Companies</option>
                    <option value="A1 Taxi">A1 Taxi</option>
                    <option value="Blue Cab">Blue Cab</option>
                    <option value="Green Ride">Green Ride</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="zoneFilter" class="form-label">Zone</label>
                <select class="form-select" id="zoneFilter" onchange="applyFilters()">
                    <option value="">All Zones</option>
                    <!-- Zones will be populated dynamically -->
                </select>
            </div>
            <div class="col-md-3">
                <label for="vehicleFilter" class="form-label">Vehicle Type</label>
                <select class="form-select" id="vehicleFilter" onchange="applyFilters()">
                    <option value="">All Types</option>
                    <option value="hatchback">Hatchback</option>
                    <option value="sedan">Sedan</option>
                    <option value="suv">SUV</option>
                </select>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Map Container -->
    <div class="col-md-9">
        <div class="card">
            <div class="card-body p-0">
                <div id="map" style="height: 600px; width: 100%;"></div>
            </div>
        </div>
    </div>
    
    <!-- Driver List Panel -->
    <div class="col-md-3" id="driver-list-panel">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-people"></i> Active Drivers
                    <span class="badge bg-primary ms-2" id="driver-count">0</span>
                </h5>
            </div>
            <div class="card-body p-0" style="max-height: 550px; overflow-y: auto;">
                <div id="driver-list-container">
                    <div class="text-center py-3">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Driver Details Modal -->
<div class="modal fade" id="driverDetailsModal" tabindex="-1" aria-labelledby="driverDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="driverDetailsModalLabel">Driver Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="driver-details-content">
                <!-- Content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
let map;
let markers = [];
let driversData = [];
let filteredDrivers = [];
let autoRefreshInterval;
let isAutoRefresh = true;

// Company colors for markers
const companyColors = {
    'A1 Taxi': '#dc3545',      // Red
    'Blue Cab': '#007bff',     // Blue
    'Green Ride': '#28a745',   // Green
    'default': '#6c757d'       // Gray
};

function initMap() {
    // Initialize map centered on Chennai (where the drivers are)
    map = new google.maps.Map(document.getElementById('map'), {
        zoom: 12,
        center: { lat: 13.0827, lng: 80.2707 }, // Chennai coordinates (where drivers are located)
        mapTypeId: 'roadmap',
        styles: [
            {
                featureType: 'poi',
                elementType: 'labels',
                stylers: [{ visibility: 'off' }]
            }
        ]
    });
    
    console.log('Map initialized, center: 13.0827, 80.2707');
    
    // Start auto refresh
    startAutoRefresh();
    
    // Initial load
    refreshDrivers();
    
    // Load zones for filter
    loadZones();
}

function refreshDrivers() {
    console.log('üöÄ Refreshing drivers...');
    fetch('/admin/api/live_driver_locations')
        .then(response => {
            console.log('üì° Response status:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('üìä Driver data received:', data);
            if (data.status === 'success') {
                driversData = data.data.drivers;
                console.log('üë• Total drivers:', driversData.length);
                
                // Clear any existing error messages on successful load
                const existingErrors = document.querySelectorAll('.alert-danger');
                existingErrors.forEach(alert => alert.remove());
                
                // Handle case when no drivers are available
                if (driversData.length === 0) {
                    console.log('‚ÑπÔ∏è No drivers currently available');
                    // Don't show error, just clear map and show empty state
                    displayDriversOnMap([]);
                    return;
                }
                
                // Debug each driver
                driversData.forEach((driver, index) => {
                    console.log(`üöó Driver ${index + 1}:`, {
                        name: driver.name,
                        lat: driver.current_lat,
                        lng: driver.current_lng,
                        online: driver.is_online,
                        hasLocation: !!(driver.current_lat && driver.current_lng)
                    });
                });
                
                // Filter to only drivers with location data for debugging
                const driversWithLocation = driversData.filter(d => d.current_lat && d.current_lng);
                console.log('üìç Drivers with location:', driversWithLocation.length);
                console.log('üéØ About to call applyFilters()');
                applyFilters();
            } else {
                console.error('‚ùå API error:', data.message);
                showError('Failed to load driver locations: ' + data.message);
            }
        })
        .catch(error => {
            console.error('üö® Network error:', error);
            showError('Network error occurred: ' + error.message);
        });
}

function displayDriversOnMap(drivers) {
    console.log('üó∫Ô∏è Displaying drivers on map:', drivers.length);
    
    // Clear existing markers
    console.log('üßπ Clearing existing markers:', markers.length);
    markers.forEach(marker => marker.setMap(null));
    markers = [];
    
    // Show empty state message if no drivers
    if (drivers.length === 0) {
        showEmptyDriverState();
        displayDriverList(drivers);
        document.getElementById('driver-count').textContent = '0';
        return;
    }
    
    // Clear empty state message if it exists
    clearEmptyDriverState();
    
    // Add new markers
    console.log('‚ûï Adding new markers...');
    drivers.forEach((driver, index) => {
        if (driver.current_lat && driver.current_lng) {
            console.log(`üìç Creating marker ${index + 1} for ${driver.name} at (${driver.current_lat}, ${driver.current_lng})`);
            try {
                const marker = createDriverMarker(driver);
                markers.push(marker);
                console.log(`‚úÖ Marker created successfully for ${driver.name}`);
            } catch (error) {
                console.error(`‚ùå Error creating marker for ${driver.name}:`, error);
            }
        } else {
            console.log(`‚ö†Ô∏è Skipping ${driver.name} - no location data (lat: ${driver.current_lat}, lng: ${driver.current_lng})`);
        }
    });
    
    console.log('üìä Total markers created:', markers.length);
    console.log('üéØ Map object:', map);
    
    // Update driver list
    console.log('üìù Updating driver list...');
    displayDriverList(drivers);
    
    // Update count
    document.getElementById('driver-count').textContent = drivers.length;
    console.log('üèÅ displayDriversOnMap completed');
}

function createDriverMarker(driver) {
    const position = { lat: parseFloat(driver.current_lat), lng: parseFloat(driver.current_lng) };
    console.log(`üéØ Creating marker for ${driver.name} at position:`, position);
    console.log('üó∫Ô∏è Map object available:', !!map);
    
    // Validate coordinates
    if (isNaN(position.lat) || isNaN(position.lng)) {
        console.error(`‚ùå Invalid coordinates for ${driver.name}:`, position);
        return null;
    }
    
    // Determine marker color based on status
    let color = '#28a745'; // Green for online
    if (!driver.is_online) {
        color = '#dc3545'; // Red for offline
    } else if (driver.out_of_zone) {
        color = '#ffc107'; // Yellow for out of zone
    }
    
    // Make stale locations semi-transparent
    let fillOpacity = 0.9;
    if (driver.is_stale) {
        fillOpacity = 0.5; // Semi-transparent for stale locations
        console.log(`‚è∞ Driver ${driver.name} has stale location data`);
    }
    
    console.log(`üé® Marker color for ${driver.name}:`, color, '(Online:', driver.is_online, ', Out of zone:', driver.out_of_zone, ')');
    
    // Create marker with custom icon
    const marker = new google.maps.Marker({
        position: position,
        map: map,
        title: `${driver.name} (${driver.car_number || 'Unknown'})`,
        icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 10,
            fillColor: color,
            fillOpacity: fillOpacity,
            strokeColor: '#ffffff',
            strokeWeight: 3
        },
        animation: google.maps.Animation.DROP
    });
    
    console.log('‚úÖ Marker created successfully for', driver.name, '- Position on map:', marker.getPosition().toString());
    
    // Create info window
    const infoWindow = new google.maps.InfoWindow({
        content: createInfoWindowContent(driver)
    });
    
    // Add hover and click listeners
    marker.addListener('mouseover', () => {
        infoWindow.open(map, marker);
    });
    
    marker.addListener('click', () => {
        // Close all other info windows
        markers.forEach(m => {
            if (m.infoWindow) {
                m.infoWindow.close();
            }
        });
        
        infoWindow.open(map, marker);
    });
    
    // Store info window reference
    marker.infoWindow = infoWindow;
    
    return marker;
}

function createInfoWindowContent(driver) {
    const statusText = driver.is_online ? 
        (driver.out_of_zone ? 'Online (Out of Zone)' : 'Online') : 'Offline';
    const statusColor = driver.is_online ? 
        (driver.out_of_zone ? '#ffc107' : '#28a745') : '#dc3545';
    
    // Format last seen time if available
    let lastSeenText = '';
    if (driver.location_updated_at) {
        const lastSeen = new Date(driver.location_updated_at);
        const now = new Date();
        const diffMinutes = Math.floor((now - lastSeen) / (1000 * 60));
        
        if (diffMinutes < 1) {
            lastSeenText = 'Just now';
        } else if (diffMinutes < 60) {
            lastSeenText = `${diffMinutes} minutes ago`;
        } else {
            const diffHours = Math.floor(diffMinutes / 60);
            lastSeenText = `${diffHours} hours ago`;
        }
    } else {
        lastSeenText = 'Unknown';
    }
    
    return `
        <div class="info-window" style="min-width: 200px;">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="mb-0"><strong>${driver.name}</strong></h6>
                <span class="badge" style="background-color: ${statusColor}; color: white;">
                    ${statusText}
                </span>
            </div>
            <p class="mb-1" style="font-size: 14px;">
                <strong>üìû Phone:</strong> ${driver.phone}<br>
                <strong>üöó Vehicle:</strong> ${driver.car_number || 'Not specified'}<br>
                <strong>üïí Last Seen:</strong> ${lastSeenText}<br>
                <strong>üöô Type:</strong> ${driver.car_type || 'Unknown'}<br>
                <strong>üè¢ Company:</strong> ${driver.company_name || 'A1 Taxi'}<br>
                <strong>üìç Zone:</strong> ${driver.zone || 'No zone'}
            </p>
            <small class="text-muted">
                Last updated: ${driver.location_updated_at ? formatDateTime(driver.location_updated_at) : 'Unknown'}
            </small>
        </div>
    `;
}

function displayDriverList(drivers) {
    const container = document.getElementById('driver-list-container');
    
    if (drivers.length === 0) {
        container.innerHTML = `
            <div class="text-center py-3">
                <i class="bi bi-person-x text-muted"></i>
                <p class="text-muted small mt-2">No drivers found</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    drivers.forEach(driver => {
        const statusBadge = getStatusBadge(driver.is_online, driver.out_of_zone);
        const typeBadge = getTypeBadge(driver.car_type);
        const companyColor = companyColors[driver.company_name] || companyColors['default'];
        
        html += `
            <div class="driver-item p-2 border-bottom" onclick="focusOnDriver(${driver.id})">
                <div class="d-flex align-items-center">
                    <div class="driver-marker-preview" style="background-color: ${companyColor}; opacity: ${driver.out_of_zone ? 0.4 : 0.8}"></div>
                    <div class="ms-2 flex-grow-1">
                        <div class="d-flex justify-content-between align-items-start">
                            <h6 class="mb-0 small">${driver.name}</h6>
                            ${statusBadge}
                        </div>
                        <p class="mb-0 small text-muted">
                            ${driver.phone}<br>
                            ${driver.car_number || 'N/A'} ${typeBadge}
                        </p>
                    </div>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function focusOnDriver(driverId) {
    const driver = driversData.find(d => d.id === driverId);
    if (driver && driver.current_lat && driver.current_lng) {
        const position = { lat: driver.current_lat, lng: driver.current_lng };
        map.setCenter(position);
        map.setZoom(15);
        
        // Find and open the marker's info window
        const marker = markers.find(m => m.getTitle().includes(driver.name));
        if (marker && marker.infoWindow) {
            marker.infoWindow.open(map, marker);
        }
    }
}

function applyFilters() {
    console.log('üîç Applying filters...');
    const statusFilter = document.getElementById('statusFilter').value;
    const companyFilter = document.getElementById('companyFilter').value;
    const zoneFilter = document.getElementById('zoneFilter').value;
    const vehicleFilter = document.getElementById('vehicleFilter').value;
    
    console.log('üéõÔ∏è Filter values:', { statusFilter, companyFilter, zoneFilter, vehicleFilter });
    
    filteredDrivers = driversData.filter(driver => {
        // Status filter
        if (statusFilter) {
            if (statusFilter === 'online' && (!driver.is_online || driver.out_of_zone)) return false;
            if (statusFilter === 'busy' && (driver.is_online && !driver.out_of_zone && driver.current_ride)) return false;
            if (statusFilter === 'offline' && driver.is_online) return false;
        }
        
        // Company filter
        if (companyFilter && driver.company_name !== companyFilter) return false;
        
        // Zone filter
        if (zoneFilter && driver.zone !== zoneFilter) return false;
        
        // Vehicle filter
        if (vehicleFilter && driver.car_type !== vehicleFilter) return false;
        
        return true;
    });
    
    console.log('‚úÖ Filtered drivers:', filteredDrivers.length, 'out of', driversData.length);
    console.log('üéØ About to display drivers on map...');
    displayDriversOnMap(filteredDrivers);
}

function showDriverDetails(driverId) {
    const driver = driversData.find(d => d.id === driverId);
    if (!driver) {
        showError('Driver not found');
        return;
    }
    
    const statusBadge = getStatusBadge(driver.is_online, driver.out_of_zone);
    const typeBadge = getTypeBadge(driver.car_type);
    
    const content = `
        <div class="row">
            <div class="col-md-6">
                <h6>Driver Information</h6>
                <table class="table table-sm">
                    <tr><td><strong>Name:</strong></td><td>${driver.name}</td></tr>
                    <tr><td><strong>Phone:</strong></td><td>${driver.phone}</td></tr>
                    <tr><td><strong>Status:</strong></td><td>${statusBadge}</td></tr>
                    <tr><td><strong>Company:</strong></td><td>${driver.company_name || 'N/A'}</td></tr>
                    <tr><td><strong>Zone:</strong></td><td>${driver.zone || 'No zone'}</td></tr>
                </table>
            </div>
            <div class="col-md-6">
                <h6>Vehicle Information</h6>
                <table class="table table-sm">
                    <tr><td><strong>Type:</strong></td><td>${typeBadge}</td></tr>
                    <tr><td><strong>Number:</strong></td><td>${driver.car_number || 'N/A'}</td></tr>
                    <tr><td><strong>Make:</strong></td><td>${driver.car_make || 'N/A'}</td></tr>
                    <tr><td><strong>Model:</strong></td><td>${driver.car_model || 'N/A'}</td></tr>
                    <tr><td><strong>Year:</strong></td><td>${driver.car_year || 'N/A'}</td></tr>
                </table>
            </div>
        </div>
        
        <div class="row mt-3">
            <div class="col-md-12">
                <h6>Location Information</h6>
                <table class="table table-sm">
                    <tr><td><strong>Latitude:</strong></td><td>${driver.current_lat || 'N/A'}</td></tr>
                    <tr><td><strong>Longitude:</strong></td><td>${driver.current_lng || 'N/A'}</td></tr>
                    <tr><td><strong>Last Update:</strong></td><td>${driver.location_updated_at ? formatDateTime(driver.location_updated_at) : 'N/A'}</td></tr>
                </table>
            </div>
        </div>
    `;
    
    document.getElementById('driver-details-content').innerHTML = content;
    
    const modal = new bootstrap.Modal(document.getElementById('driverDetailsModal'));
    modal.show();
}

function toggleFilters() {
    const panel = document.getElementById('filters-panel');
    if (panel.style.display === 'none') {
        panel.style.display = 'block';
    } else {
        panel.style.display = 'none';
    }
}

function toggleDriverList() {
    const panel = document.getElementById('driver-list-panel');
    const mapCol = document.querySelector('.col-md-9');
    
    if (panel.style.display === 'none') {
        panel.style.display = 'block';
        mapCol.className = 'col-md-9';
    } else {
        panel.style.display = 'none';
        mapCol.className = 'col-md-12';
    }
    
    // Trigger map resize
    google.maps.event.trigger(map, 'resize');
}

function toggleAutoRefresh() {
    const btn = document.getElementById('autoRefreshBtn');
    
    if (isAutoRefresh) {
        clearInterval(autoRefreshInterval);
        isAutoRefresh = false;
        btn.innerHTML = '<i class="bi bi-pause"></i> Auto Refresh: OFF';
        btn.classList.remove('btn-success');
        btn.classList.add('btn-warning');
    } else {
        startAutoRefresh();
        isAutoRefresh = true;
        btn.innerHTML = '<i class="bi bi-arrow-clockwise"></i> Auto Refresh: ON';
        btn.classList.remove('btn-warning');
        btn.classList.add('btn-success');
    }
}

function startAutoRefresh() {
    autoRefreshInterval = setInterval(() => {
        refreshDrivers();
    }, 3000); // Refresh every 3 seconds
}

function loadZones() {
    fetch('/admin/api/zones')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                const zoneSelect = document.getElementById('zoneFilter');
                data.data.zones.forEach(zone => {
                    const option = document.createElement('option');
                    option.value = zone.zone_name;
                    option.textContent = zone.zone_name;
                    zoneSelect.appendChild(option);
                });
            }
        })
        .catch(error => {
            console.error('Error loading zones:', error);
        });
}

function getStatusBadge(isOnline, outOfZone) {
    if (!isOnline) {
        return '<span class="badge bg-secondary">Offline</span>';
    } else if (outOfZone) {
        return '<span class="badge bg-warning">Out of Zone</span>';
    } else {
        return '<span class="badge bg-success">Online</span>';
    }
}

function getTypeBadge(type) {
    const badges = {
        'hatchback': '<span class="badge bg-light text-dark">Hatchback</span>',
        'sedan': '<span class="badge bg-primary">Sedan</span>',
        'suv': '<span class="badge bg-success">SUV</span>'
    };
    return badges[type] || '<span class="badge bg-secondary">Unknown</span>';
}

function formatDateTime(dateString) {
    const date = new Date(dateString);
    return date.toLocaleString();
}

function showError(message) {
    // Clear existing error alerts first
    const existingErrors = document.querySelectorAll('.alert-danger');
    existingErrors.forEach(alert => alert.remove());
    
    const alert = document.createElement('div');
    alert.className = 'alert alert-danger alert-dismissible fade show';
    alert.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    const main = document.querySelector('main .pt-3');
    main.insertBefore(alert, main.firstChild);
}

function showEmptyDriverState() {
    clearEmptyDriverState(); // Clear any existing empty state
    
    const alert = document.createElement('div');
    alert.className = 'alert alert-info alert-dismissible fade show';
    alert.id = 'empty-driver-state';
    alert.innerHTML = `
        <i class="bi bi-info-circle me-2"></i>
        No drivers are currently online or available for tracking.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    const main = document.querySelector('main .pt-3');
    main.insertBefore(alert, main.firstChild);
}

function clearEmptyDriverState() {
    const existingEmptyState = document.getElementById('empty-driver-state');
    if (existingEmptyState) {
        existingEmptyState.remove();
    }
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    // Initialize map when page loads
    if (typeof google !== 'undefined' && google.maps) {
        initMap();
    } else {
        // Fallback if Google Maps is not available
        document.getElementById('map').innerHTML = `
            <div class="d-flex align-items-center justify-content-center h-100">
                <div class="text-center">
                    <i class="bi bi-map display-1 text-muted"></i>
                    <p class="mt-3 text-muted">Google Maps not available</p>
                    <p class="text-muted">Please check your API key configuration</p>
                </div>
            </div>
        `;
    }
});

// Cleanup on page unload
window.addEventListener('beforeunload', function() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
    }
});
</script>

<!-- Load Google Maps API with error handling -->
<script>
// Global error handler for Google Maps API
window.gm_authFailure = function() {
    console.warn('Google Maps API authentication failed - billing not enabled');
    handleMapsUnavailable();
};

function handleMapsUnavailable() {
    document.getElementById('map').innerHTML = `
        <div class="d-flex align-items-center justify-content-center h-100">
            <div class="text-center">
                <i class="bi bi-map display-1 text-muted"></i>
                <p class="mt-3 text-muted">Google Maps not available</p>
                <p class="text-muted">Please check your API key configuration</p>
            </div>
        </div>
    `;
}

// Initialize Google Maps or handle gracefully
function initializeGoogleMaps() {
    try {
        if (typeof google !== 'undefined' && google.maps) {
            initMap();
        } else {
            handleMapsUnavailable();
        }
    } catch (error) {
        console.warn('Google Maps initialization failed:', error);
        handleMapsUnavailable();
    }
}

// Load Google Maps API with error handling
if (typeof google === 'undefined') {
    const script = document.createElement('script');
    script.src = 'https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initializeGoogleMaps';
    script.async = true;
    script.defer = true;
    script.onerror = function() {
        console.warn('Failed to load Google Maps API');
        handleMapsUnavailable();
    };
    document.head.appendChild(script);
} else {
    initializeGoogleMaps();
}
</script>

<style>
.driver-marker-preview {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid #ffffff;
    flex-shrink: 0;
}

.driver-item {
    cursor: pointer;
    transition: background-color 0.2s;
}

.driver-item:hover {
    background-color: var(--bs-light);
}

.info-window {
    max-width: 250px;
}

.info-window h6 {
    color: #495057;
}

.info-window .badge {
    font-size: 0.7rem;
}

#map {
    border-radius: 8px;
}

.card {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
</style>
{% endblock %}