# A1 Call Taxi - Driver App API Documentation

## Overview
Complete API documentation for the A1 Call Taxi driver mobile application. This guide provides all endpoints, request/response formats, field requirements, and route types needed for driver app integration.

**Base URL**: `https://your-backend-domain.com/driver/`
**Content-Type**: `application/json`
**Authentication**: Session-based after login

---

## API Endpoints Summary

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/login` | POST | Driver authentication |
| `/logout` | POST | End driver session |
| `/status` | GET/POST | Get/Update online status |
| `/incoming_rides` | GET | Get available rides |
| `/accept_ride` | POST | Accept a ride request |
| `/reject_ride` | POST | Reject a ride request |
| `/current_ride` | GET | Get active ride details |
| `/arrived` | POST | Mark arrival at pickup |
| `/start_ride` | POST | Start ride with OTP |
| `/complete_ride` | POST | Complete the ride |
| `/cancel_ride` | POST | Cancel accepted ride |
| `/update_location` | POST | Update GPS during ride |
| `/update_current_location` | POST | Update current location |
| `/get_zone_status` | GET | Get zone assignment |

---

## 1. Driver Authentication

### 1.1 Login
**Endpoint**: `POST /driver/login`

**Request Body**:
```json
{
    "username": "string (required)",
    "password": "string (required)"
}
```

**Field Requirements**:
- `username`: Driver's username (auto-generated by admin)
- `password`: Driver's password (set by admin)

**Success Response** (200):
```json
{
    "success": true,
    "message": "Login successful",
    "data": {
        "driver_id": 1,
        "name": "Ricco",
        "phone": "9876543210",
        "username": "DRVVJ53TA",
        "is_online": true,
        "car_make": "Toyota",
        "car_model": "Innova",
        "car_year": 2020,
        "car_number": "TN01AB1234",
        "car_type": "suv"
    }
}
```

**Error Response** (400):
```json
{
    "success": false,
    "message": "Invalid username or password"
}
```

### 1.2 Logout
**Endpoint**: `POST /driver/logout`

**Request Body**: `{}` (empty)

**Success Response** (200):
```json
{
    "success": true,
    "message": "Logout successful"
}
```

---

## 2. Driver Status Management

### 2.1 Get Online Status
**Endpoint**: `GET /driver/status?mobile=9876543210`

**Query Parameters**:
- `mobile`: Driver's 10-digit phone number (required)

**Success Response** (200):
```json
{
    "success": true,
    "message": "Driver status retrieved",
    "data": {
        "is_online": true,
        "driver_id": 1,
        "name": "Ricco",
        "phone": "9876543210"
    }
}
```

### 2.2 Update Online Status
**Endpoint**: `POST /driver/status`

**Request Body**:
```json
{
    "mobile": "9876543210",
    "is_online": true
}
```

**Field Requirements**:
- `mobile`: 10-digit phone number (required)
- `is_online`: Boolean true/false (required)

**Success Response** (200):
```json
{
    "success": true,
    "message": "Driver status updated to online",
    "data": {
        "driver_id": 1,
        "name": "Ricco",
        "phone": "9876543210",
        "is_online": true
    }
}
```

**Error Cases**:
- Cannot go offline while having active ride
- Invalid phone number format

---

## 3. Ride Management

### 3.1 Get Available Rides
**Endpoint**: `GET /driver/incoming_rides?phone=9876543210&driver_location=13.0827,80.2707`

**Query Parameters**:
- `phone`: Driver's 10-digit phone number (required)
- `driver_location`: "latitude,longitude" for distance calculation (optional)

**Success Response** (200):
```json
{
    "success": true,
    "message": "Incoming rides retrieved",
    "data": {
        "rides": [
            {
                "id": 1,
                "customer_phone": "9123456789",
                "customer_name": "John Doe",
                "pickup_address": "Anna Nagar, Chennai",
                "drop_address": "T.Nagar, Chennai",
                "pickup_lat": 13.0850,
                "pickup_lng": 80.2101,
                "drop_lat": 13.0435,
                "drop_lng": 80.2339,
                "distance_km": 5.2,
                "fare_amount": 125.50,
                "ride_type": "suv",
                "ride_category": "regular",
                "status": "pending",
                "created_at": "2025-08-02T10:30:00",
                "distance_to_pickup_km": 2.1
            }
        ],
        "count": 1
    }
}
```

**Notes**:
- Only shows rides matching driver's vehicle type
- Excludes previously rejected rides
- Distance calculation requires Google Maps API
- Only online drivers receive rides

### 3.2 Accept Ride
**Endpoint**: `POST /driver/accept_ride`

**Request Body**:
```json
{
    "ride_id": 1,
    "driver_phone": "9876543210"
}
```

**Field Requirements**:
- `ride_id`: Integer (required)
- `driver_phone`: 10-digit phone number (required)

**Success Response** (200):
```json
{
    "success": true,
    "message": "Ride accepted successfully",
    "data": {
        "ride_id": 1,
        "status": "accepted",
        "customer_name": "John Doe",
        "pickup_address": "Anna Nagar, Chennai",
        "drop_address": "T.Nagar, Chennai",
        "fare_amount": 125.50
    }
}
```

**Error Cases**:
- Driver already has ongoing ride
- Ride no longer available
- Driver not found

### 3.3 Reject Ride
**Endpoint**: `POST /driver/reject_ride`

**Request Body**:
```json
{
    "ride_id": 1,
    "driver_phone": "9876543210"
}
```

**Success Response** (200):
```json
{
    "success": true,
    "message": "Ride rejected successfully",
    "data": {
        "ride_id": 1,
        "message": "Ride rejected"
    }
}
```

### 3.4 Get Current Active Ride
**Endpoint**: `GET /driver/current_ride?phone=9876543210`

**Query Parameters**:
- `phone`: Driver's 10-digit phone number (required)

**Success Response** (200):
```json
{
    "success": true,
    "message": "Current ride retrieved",
    "data": {
        "has_active_ride": true,
        "id": 1,
        "customer_name": "John Doe",
        "customer_phone": "9123456789",
        "pickup_address": "Anna Nagar, Chennai",
        "drop_address": "T.Nagar, Chennai",
        "pickup_lat": 13.0850,
        "pickup_lng": 80.2101,
        "drop_lat": 13.0435,
        "drop_lng": 80.2339,
        "fare_amount": 125.50,
        "status": "accepted",
        "created_at": "2025-08-02T10:30:00",
        "accepted_at": "2025-08-02T10:32:00"
    }
}
```

**No Active Ride Response**:
```json
{
    "success": true,
    "message": "No active ride",
    "data": {
        "has_active_ride": false
    }
}
```

---

## 4. Ride Lifecycle Management

### 4.1 Mark Arrival at Pickup
**Endpoint**: `POST /driver/arrived`

**Request Body**:
```json
{
    "driver_phone": "9876543210"
}
```

**Success Response** (200):
```json
{
    "success": true,
    "message": "Arrival confirmed",
    "data": {
        "ride_id": 1,
        "status": "arrived"
    }
}
```

**Requirements**:
- Driver must have accepted ride
- Ride status must be "accepted"

### 4.2 Start Ride with OTP
**Endpoint**: `POST /driver/start_ride`

**Request Body**:
```json
{
    "ride_id": 1,
    "otp": "123456"
}
```

**Field Requirements**:
- `ride_id`: Integer (required)
- `otp`: 6-digit numeric string (required)

**Success Response** (200):
```json
{
    "success": true,
    "message": "Ride started successfully",
    "data": {
        "ride_id": 1,
        "status": "started"
    }
}
```

**Error Cases**:
- Invalid OTP format (must be 6 digits)
- Wrong OTP code
- Ride not in correct status
- Driver not authorized for this ride

### 4.3 Complete Ride
**Endpoint**: `POST /driver/complete_ride`

**Request Body**:
```json
{
    "driver_phone": "9876543210"
}
```

**Success Response** (200):
```json
{
    "success": true,
    "message": "Ride completed successfully",
    "data": {
        "ride_id": 1,
        "status": "completed",
        "fare_amount": 125.50
    }
}
```

### 4.4 Cancel Ride
**Endpoint**: `POST /driver/cancel_ride`

**Request Body**:
```json
{
    "driver_phone": "9876543210"
}
```

**Success Response** (200):
```json
{
    "success": true,
    "message": "Ride cancelled successfully",
    "data": {
        "ride_id": 1,
        "status": "pending"
    }
}
```

**Notes**:
- Can only cancel rides in "accepted" or "arrived" status
- Cannot cancel started rides
- Ride returns to pending status for other drivers

---

## 5. GPS Location Updates

### 5.1 Update Location During Ride
**Endpoint**: `POST /driver/update_location`

**Request Body**:
```json
{
    "driver_phone": "9876543210",
    "ride_id": 1,
    "latitude": 13.0827,
    "longitude": 80.2707
}
```

**Field Requirements**:
- `driver_phone`: 10-digit phone number (required)
- `ride_id`: Integer (required)
- `latitude`: Float between -90 and 90 (required)
- `longitude`: Float between -180 and 180 (required)

**Success Response** (200):
```json
{
    "success": true,
    "message": "Location updated successfully",
    "data": {
        "ride_id": 1,
        "latitude": 13.0827,
        "longitude": 80.2707,
        "timestamp": "2025-08-02T10:45:00"
    }
}
```

**Notes**:
- Only for active rides (accepted, arrived, started)
- Used for customer tracking
- Creates ride location history

### 5.2 Update Current Location
**Endpoint**: `POST /driver/update_current_location`

**Request Body**:
```json
{
    "phone": "9876543210",
    "latitude": 13.0827,
    "longitude": 80.2707
}
```

**Success Response** (200):
```json
{
    "success": true,
    "message": "Current location updated successfully",
    "data": {
        "driver_id": 1,
        "latitude": 13.0827,
        "longitude": 80.2707,
        "updated_at": "2025-08-02T10:45:00",
        "zone": "Chennai Central",
        "out_of_zone": false
    }
}
```

**Notes**:
- For proximity-based dispatch
- Automatically updates zone assignment
- Used when driver is available for rides

---

## 6. Zone Management

### 6.1 Get Zone Status
**Endpoint**: `GET /driver/get_zone_status?phone=9876543210`

**Query Parameters**:
- `phone`: Driver's 10-digit phone number (required)

**Success Response** (200):
```json
{
    "success": true,
    "message": "Zone status retrieved",
    "data": {
        "driver_id": 1,
        "current_lat": 13.0827,
        "current_lng": 80.2707,
        "zone_id": 1,
        "zone_name": "Chennai Central",
        "out_of_zone": false,
        "location_updated_at": "2025-08-02T10:45:00"
    }
}
```

---

## 7. Data Models & Field Formats

### 7.1 Driver Model
```json
{
    "id": "integer",
    "name": "string (100 chars max)",
    "phone": "string (10 digits, unique)",
    "username": "string (50 chars, auto-generated)",
    "is_online": "boolean",
    "car_make": "string (50 chars)",
    "car_model": "string (50 chars)",
    "car_year": "integer",
    "car_number": "string (20 chars)",
    "car_type": "string (hatchback|sedan|suv)",
    "current_lat": "float (-90 to 90)",
    "current_lng": "float (-180 to 180)",
    "zone_id": "integer (foreign key)",
    "out_of_zone": "boolean"
}
```

### 7.2 Ride Model
```json
{
    "id": "integer",
    "customer_phone": "string (10 digits)",
    "pickup_address": "text",
    "drop_address": "text",
    "pickup_lat": "float",
    "pickup_lng": "float",
    "drop_lat": "float",
    "drop_lng": "float",
    "distance_km": "float",
    "fare_amount": "float",
    "ride_type": "string (hatchback|sedan|suv)",
    "ride_category": "string (regular|airport|rental|outstation)",
    "status": "string (pending|accepted|arrived|started|completed|cancelled)",
    "start_otp": "string (6 digits)",
    "created_at": "datetime (ISO format)",
    "accepted_at": "datetime (ISO format)",
    "arrived_at": "datetime (ISO format)",
    "started_at": "datetime (ISO format)",
    "completed_at": "datetime (ISO format)"
}
```

---

## 8. Ride Types & Categories

### 8.1 Vehicle Types (ride_type)
- `hatchback`: Small cars (Alto, Swift, etc.)
- `sedan`: Mid-size cars (Dzire, City, etc.)
- `suv`: Large vehicles (Innova, Ertiga, etc.)

### 8.2 Ride Categories (ride_category)
- `regular`: Standard city rides
- `airport`: Airport pickup/drop
- `rental`: Hourly rentals
- `outstation`: Inter-city travel

---

## 9. Status Flow

### 9.1 Ride Status Progression
```
pending → accepted → arrived → started → completed
         ↓
      cancelled (only from accepted/arrived)
```

### 9.2 Driver Actions by Status
- **pending**: Can accept or reject
- **accepted**: Can arrive or cancel
- **arrived**: Can start (with OTP) or cancel
- **started**: Can complete only
- **completed**: No actions available

---

## 10. Error Handling

### 10.1 Common Error Responses
```json
{
    "success": false,
    "message": "Error description"
}
```

### 10.2 HTTP Status Codes
- `200`: Success
- `400`: Bad Request (validation errors)
- `401`: Unauthorized (authentication required)
- `403`: Forbidden (invalid OTP, etc.)
- `404`: Not Found (driver/ride not found)
- `500`: Internal Server Error

### 10.3 Phone Number Validation
- Must be exactly 10 digits
- Numeric characters only
- No country code prefix

### 10.4 GPS Coordinate Validation
- Latitude: -90 to 90 degrees
- Longitude: -180 to 180 degrees
- Float format required

---

## 11. Integration Notes

### 11.1 Session Management
- Login creates server-side session
- Session persists until logout
- No token-based authentication

### 11.2 Real-time Updates
- Poll `/current_ride` every 30 seconds
- Update location every 10 seconds during rides
- Check `/incoming_rides` when online

### 11.3 Geographic Features
- Zone-based dispatch system
- Proximity calculations using Google Maps API
- Automatic zone assignment based on location

### 11.4 OTP System
- 6-digit numeric OTP generated on ride acceptance
- Customer shares OTP with driver
- Required to start ride
- OTP cleared after successful verification

---

## 12. Sample Integration Flow

```javascript
// 1. Driver Login
POST /driver/login
{
    "username": "DRVVJ53TA",
    "password": "driver123"
}

// 2. Go Online
POST /driver/status
{
    "mobile": "9876543210",
    "is_online": true
}

// 3. Update Location
POST /driver/update_current_location
{
    "phone": "9876543210",
    "latitude": 13.0827,
    "longitude": 80.2707
}

// 4. Check for Rides
GET /driver/incoming_rides?phone=9876543210

// 5. Accept Ride
POST /driver/accept_ride
{
    "ride_id": 1,
    "driver_phone": "9876543210"
}

// 6. Mark Arrival
POST /driver/arrived
{
    "driver_phone": "9876543210"
}

// 7. Start Ride
POST /driver/start_ride
{
    "ride_id": 1,
    "otp": "123456"
}

// 8. Update Location During Ride
POST /driver/update_location
{
    "driver_phone": "9876543210",
    "ride_id": 1,
    "latitude": 13.0435,
    "longitude": 80.2339
}

// 9. Complete Ride
POST /driver/complete_ride
{
    "driver_phone": "9876543210"
}
```

This documentation provides complete API coverage for driver app development with A1 Call Taxi backend system.