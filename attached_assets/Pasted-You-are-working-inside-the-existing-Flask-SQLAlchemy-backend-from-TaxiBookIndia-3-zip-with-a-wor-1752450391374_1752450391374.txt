You are working inside the existing Flask + SQLAlchemy backend from TaxiBookIndia (3).zip with a working Admin UI using Jinja2 templates and Leaflet.js.

Your task is to enhance the system with:

âœ… 1. Concentric Ring Configuration (per Polygon Zone)
ğŸ”¸ Models (models.py)
Modify the existing Zone model:

python
Copy
Edit
class Zone(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    zone_name = db.Column(db.String(100), nullable=False)
    polygon_points = db.Column(db.Text, nullable=False)  # Stored as JSON string
    number_of_rings = db.Column(db.Integer, default=3)
    ring_radius_meters = db.Column(db.Integer, default=1000)
    ring_wait_time_seconds = db.Column(db.Integer, default=15)
âœ… 2. Admin UI Updates (templates/admin/zones.html)
ğŸ”¸ Add new controls in the form (next to polygon drawing tools):
Number of Rings (input: number)

Ring Radius (in meters)

Wait Time per Ring (in seconds)

ğŸ”¸ Update Leaflet zone save logic to:
Include the new values

Send to /admin/api/zones via fetch POST or PUT

âœ… 3. Backend Logic â€“ Zone Ring Expansion (Ride Dispatch)
ğŸ”¸ Ride Booking Logic (routes/customer.py)
Enhance the ride assignment logic to:

When ride is booked:

Find the polygon zone where pickup_location belongs

If none â†’ reject with â€œOut of service areaâ€

If zone found:

Use the number_of_rings, ring_radius_meters, and ring_wait_time_seconds for that zone

Notify only drivers in:

Ring 1 (center = polygon centroid, radius = r1)

If no response in t1, expand to Ring 2 â†’ Ring 3...

After last ring, expand to neighboring zones (based on admin logic or zone priority)

Then, global fallback

âœ… 4. Extra Fare for Out-of-Zone Rides
ğŸ”¸ Fare Calculation Logic
As soon as no driver found inside pickup zone, fallback is triggered.

Extra fare must be added:

Calculate distance between pickup zone center and fallback driverâ€™s zone center

Multiply by fixed rate (e.g., â‚¹10/km) â†’ extra_fare

Total fare = base_fare + distance_fare + extra_fare

ğŸ”¸ Prompt to Customer
Show message:
â€œNo driver found in your area. An extra fare of â‚¹X is applicable to bring a driver from another zone. Proceed?â€

If approved, proceed with assignment

If rejected, cancel ride

âœ… 5. Backend API Updates
ğŸ”¸ GET /admin/api/zones
Return new fields: number_of_rings, ring_radius_meters, ring_wait_time_seconds

ğŸ”¸ PUT /admin/api/zones/<zone_id>
Allow updating ring settings

âœ… 6. Optional â€“ Utilities
Add helper to calculate polygon centroid:

python
Copy
Edit
def get_polygon_centroid(polygon_points):
    # Expects list of {'lat': ..., 'lng': ...}
    lat_sum = sum(p['lat'] for p in polygon_points)
    lng_sum = sum(p['lng'] for p in polygon_points)
    return {
        "lat": lat_sum / len(polygon_points),
        "lng": lng_sum / len(polygon_points)
    }
ğŸš« DO NOT:
Break or modify existing zone saving code

Change Zone.id or polygon structure

Modify login/auth flows

âœ… Once Complete:
All zones can have custom expansion settings

Ride dispatch respects rings and fallback stages

Extra fare is dynamic (not fixed â‚¹50)

Admin UI lets you manage everything visually